Troisième partie 
Analyse matérielle du TO8 
1. Analyse générale 

Conception générale -Description 
Le micro-ordinateur TOB est conçu comme ses prédécesseurs, à partir d'un 6809 E, microprocesseur commandé à la fréquence de 1 MHz par deux horloges extérieures en quadrature: E et Q. 
Le bus d'adresses 16 bits est direct et permet d'accéder aux différentes mémoires mortes et aux registres. 
Le bus de données 8 bits véhiculant les principaux échanges a une ramification particulière:lebusdedonnéesRAM quiestbufferiséetreliéparun74LS245. Pendant la phase non active du 6809, ce bus est isolé du bus de données prin- cipal par l'action du 74 LS245 commandé par le signal TRANS. C'est durant 
cette période que le gate array accède aux mémoires en "mode page”. 
Les lignes de contrôles du 6809 E correspondent: 
— aux commandes de lecture écriture R/WN des différents registres et mémoires, 
— aux demandes d'interruption IRQN concemant la gestion du clavier, le clignotement du curseur, les manettes de jeux et la souris, 
— aux demandes d'interruption FIRQN pour le fonctionnement du crayon optique et du code barre, 
Un circuit de réinitialisation "RESET" est en relation avec le 6809 E et diffé- rents circuits, tels que le contrôleur de clavier 6804. 
#Pour lamémoire morte 
Les deux pages de 6 Ko du moniteur ainsi que les deux pages de 1,9 Ko de logiciel contrôleur de disque sont logées dans une EPROM 16 Ko 27 128. 
Les 2 x 32 Ko de logiciel d'application BASIC 1 - divers - BASIC 512 - EXTRAMONITEUR, sont logés chacun dans une ROM ou EPROM 32 Ko selon une répartition en quatre banques. 
La commutation des banques s'effectue en programmation par une écriture d'adresses ROM dans un latch 74 LS 173. Ce circuit permet de sélecter chaque partie concernée dans une des mémoires mortes. 
La cartouche de logiciel d'application externe est reliée à l'unité centrale par l'intermédiaire d'un connecteur. Elle est sélectée par logiciel à partir d'un bit de PIA du 6846. 

»Pour lamémoire vive 
Huit boîtiers 256 Kbits 41256 forment un plan mémoire de 256 Ko comprenant un découpagede pages logiques de 16 Ko. 
Les différentes pages sont commutées par un adressage physique sur 18 bits en provenancedu gate array mode page. 
L'extension mémoire, accessible par un connecteur de carte relié au bus de données RAM, est constituée de huit boîtiers 41256 qui regroupent seize autres pages de RAM utilisateur (pages 16 à 31) adressées de la méme manière et différenciées par le signal CAS2N. 
Outre le 6809 E, l'élément vital de l'unité centrale est un circuit à réseau logique (gate array) appelé "mode page" car il permet, par un bus d'adresses multiplexées, de faire fonctionner les RAMS dynamiques 41256 dans le type de mode susnommé. 
Pendant la phase non active du CPU, il assure le rafraîchissement des mémoires et de l'écran. Piloté par une horloge mère de 16 MHz, il délivre les différents signaux de timing et de commande vidéo. Il fabrique tous les décodages d'adresses. Il gère, en partie, le fonctionnement du crayon optique par le signal CKLPN, Il regroupe et produit les huit modes d'affichage et définit les couleurs du cadre. Il permet de définir la carte mémoire en quatre espaces logiques principaux: 
L'espace "cartouche” de 0000 à 3FFF L'espace "écran” de 4000 à SFFF L'espace "système” de 6000 à 9FFF L'espace “données” de A000 à DFFF 
Ilautorisel'utilisateuràaffecterunepagedeRAMàunespacelogiqueselon certaines modalités; notamment, ilpermet de recouvrir 16 Ko de logiciel par une page de mémoire vive. 
Un circuit de palette du type EF 9369, programmable par le 6809 E, permet sous la dépendance du mode d'affichage déterminé une variété de seize teintes exploitables directement par l'écran parmi un choix de 4 096 au total. 
Il délivre les trois informations B, V, R reprises et adaptées par des circuits d'interfaçage vidéo comprenant, entre autres, le dispositif d'incrustation. Ces circuits, recevant des signaux de synchronisation et de blanking du gate array, fournissent les tensions et adaptations nécessaires pour la prise péritel aux normes SCART ainsi que pour un éventuel codeur modulateur PAL dans la version export. 

Un deuxième connecteur de carte, appelé polyvalent, permet de relier les bus et signaux nécessaires aux extensions. 
Trois circuits d'interface sont en relation avec différents périphériques: 
— Un 6846 qui assure par le timer l'envoi codé des informations numériques à enregistrer sur le magnétophone LEP (sauvegarde). Inversement, une ligne du PIA récupère les informations numériques décodées en provenance du LEP (chargement). Les autres lignes du PIA sont affectées à la commande de silence ou "MUTE" en utilisation de la souris, à ia prise en compte du signal BUSY de l'imprimante, à la communication avec le 6804 pour la gestion du clavier, au traitement de l'information “tactile” du crayon optique LP (signal INTERLP) et, enfin, à la commutation des logiciels internes ou de la cartouche exieme. 
— Un 6821 "musique et jeux" qui est chargé par ses deux ports de huit bits et ses Quatre lignes de contrôle de la génération du son et de la liaison manettes des jeux et souris. Un convertisseur numérique analogique CNA récupère le son synthétisé et l'envoie vers un circuit mélangeur recevant, par ailleurs, le son du LEP et la commande de MUTE, La sortie du mélangeur alimente la prise peritel et une prise auxiliaire CINCH. 
- Un 6821 "système" qui assure principalement, par l'intermédiaire d'un connecteur spécialisé, la gestion d'une imprimante en mode paralièle de type CENTRONICS, prend en compte, par le signal KTEST, l'action d'une touche du clavier, procure les demandes d'incrustation et la télécommande du moteur LEP, 
Un microprocesseur monochip du type 6804 sert de contrôleur de clavier, Piloté par une horloge oscillant à11 MHz, ildialogue en transmission série codée avec le 6809 E par le truchement du 6846. La liaison est effectuée dans les deux sens A l'aide de deux fils DATAS et ACK. Le clavier est relié au 6804 par deux connecteurs assurant une transmission parallèle, 
Un contrôleur de disquettes, sous forme d'un deuxième circuit à réseau logique ou gate array (THMFCO1), programmable par le 6809 E, délivre par l'intermédiaire d'une prises DIN 14 broches les signaux nécessaires au fonctionnement d'un lecteur de disquettes. 
Une alimentation à découpage au secondaire fabrique les deux tensions de + 5 V et + 12 V nécessaires à la configuration de l'unité centrale. 

2. Le 6809 E dans le TO8 
Suivant la lignée de ses prédecesseurs, le fonctionnement général du TOB8 est basé sur le principe fondamental de la phase active et non active du 6809 E (cf. étude du TO9, paragraphe sur le Principe fondamental page 34). 
La fréquence des horloges E et Q en provenance du gate array reste de 1 MHz et la constante de temps du RESET de 1 seconde. 
La structure de bus est simplifiée. Un seul buffer 74 LS 245 est utilisé pour Taiguillage du bus de données RAM (cf. synoptique). En dehors de l'action de R/WN déterminant le sens du tranfert des informations, le 74 LS 245 est commandé par le signal TRANSN réagissant en fonction de E, des zones adressées et indirectement du CSCRTN (cf. commutation des logiciels) selon la forme: 
E 0 
CSCRTN zones adressées TRANSN x XXXX 1 
1 0 1 1 1 1 
0000-3FFF 1 
0000-3FFF
4000-DFFF
0 } validation 0 }du buffer 
La consultation de ce tableau amène les remarques suivantes: 
Pour E = 0, ie CPU n'a pas accès au bus RAM. Ce dernier est réservé au rafraîchissement. 
Pour E = 1, selon la programmation du gate array mode page, la zone d'adresse 0000-3FFF initialement réservée pour les logiciels internes ou externes peut être attribuée à une page de RAM. Dans ce cas, CSCRN = 1 et le signal TRANSN = 0 valident le buffer permettant au microprocesseur d'accéder à la mémoire vive, 
Exceptées les zones d'adresses du gate array mode page, l'espace E000-FFFF reste en majorité innaccessible par le CPU à travers le bus RAM. 
Les deux entrées d'interruptions utilisées sont IRQN et FIRQN. La première sert À gérer le clignotement du curseur (sortie du TIMER 6846), le fonctionnement du clavier (PIA du 6846) ou d'un périphérique externe tel que manettes de jeux, souris (6821 musique etjeux). La deuxième gère l'action du phototransistor dans Ie crayon optique lors d'une visée (gate array mode page) ou, en relation avec un logiciel adapté, l'action d'un éventuel capteur de “code barre". 

3. Gestion de la mémoire morte 
Contrairement au TO7, au TO7/70 et d'une façon similaire au TO9, le TO8 est livré avec des logiciels intégrés qui sont adressés dans le même espace mémoire que la cartouche. Le moniteur, quant à lui, réside dans une autre partie de zone mémoire. 
Description des logiciels 
La mémoire morte inierne du TOS est répartie en trois boîtiers: 
— Une ROM ou EPROM de 32 Ko (27256) organisée en deux pages de 16 Ko (banque 0, banque 1) contenant le BASIC 512 et l'EXTRAMONITEUR. 
— Une ROM ou EPROM de 32 Ko (27256) organisée en deux pages de 16 Ko (banque 2, banque 3) contenant le BASIC 1, la page d'en-tête, le réglage palette et le DOS ICONIQUE. 
— Une ROM ou EPROM de 16 Ko (27128) organisée en deux pages de 8 Ko contenantleMONITEUR del'unitécentraleetdulecteurdedisquettesexterne. 
La cartouche enfichable de 16 Ko ou 32 Ko représente la mémoire morte exteme. 
Commutation des logiciels 
La figure 17 décrit le mécanisme général de fonctionnement. 
De par les décodages d'adresses CSCRTN et CSMN en provenance du gate array mode page, le système assure la sélection de la zone cartouche 0000-3FFF et zone moniteur E000-FFFF moins quelques adresses prises par les registres des circuits périphériques. 
- 
Sélection d’une page moniteur 
Par construction, le bit P4 du 6846 étant relié au bit A13 du bus d'adresse de la mémoire de 16 Ko, ce bit permet de choisir la page de 8 Ko haute ou basse du boîtier. Ainsi: 
P4 =0 ==> partie basse de la ROM P4=1==>partiehaudetlaeROM 
Fiatchs A1cn 
|— 
La résistance reliée à la masse a pour effet, lors de l'initialisation, de rendre accessible automatiquement la partie basse de la ROM, P4 étant positionnée en entrée. 
Sélection entre logiciels résidents et cartouche 
La commutation se fait à partir du bit P2 du 6846 qui, combiné avec le décodage d'adresse CSCRTN, restitue à travers une logique ciblée les deux commandes telles que: 
CS résident= CSCRT +P2 TScartouche=CSCRT +P2 
Ainsi, pour P2 = 0: 
CS cartouche est actif dans le champ d'adresses 0000-3FFF et valide la cartouche. 
CS résident est inactif. 
Ainsi, pour P2 = L: 
CS résident est actif dans le champ d'adresses 0000-3FFF et valide les deux boîtiers de logiciels internes. 
CS cartouche est inactif. 
De par l'action du gate array mode page, ce montage offre la possibilité d'inhiber les logiciels dans l'espace mémoire 0000-3FFF qui leur est normalement alloué. Dans ce cas de figure, CSCRTN = 1 constant. Ce type de fonctionnement permet à l'utilisateur de substituer de la ROM par une page de RAM pouvant être, par ailleurs, chargée par un logiciel en provenance d'une mémoire de masse (cf. fonctionnement du gate array mode page, page 105), 
Sélection des quatre banques de logiciels internes 
Le mécanisme employé est comparable à celui utilisé par les cartouches (COLORCALC, COLORPAINT, BASIC I .... et par le TO9 (en remplagant le signal CSN par CSCRTN). 

4. Les mémoires vives 
Technologiquement, les 256 Ko de mémoire vive résidente du TO8 sont consti- tués par 8 boitiers intégrés du type 41256. Ces circuits ont une capacité de 256K x 1 bit. Pour une reconstitution en données de 8 bits, huit 41256 sont associées, chacune étant spécialisée par un poids de D7 à DO (cf. figure 18) 
GATE ARRAY MODE PAGE 
TRAÎTEMENT MULTIPLEXAGE 
EXTENSION MEMOIRE


Fonctionnement d'une 41256 
Les 41256 sont des mémoires vives dynamiqurgs qui permettentde stocker sous forme de matrice de 27 = 512 lignes et de 27 = 512 colonnes, 512 x 512 = 256 Kbits. L'adressage d'une telle matrice, à structure symétrique, nécessite 2 x 9 bits d'adressage envoyés en deux temps sur les 9 fils du bus d'adresse correspondant. Aux 9 bits de poids faible correspond l'adressage ligne validé par Ie signal de ligne RASN; aux 9 bits de poids fort correspond l'adressage colonne validé par le signal de colonne CASN. Le diagramme suivant précise la forme multiplexée de l'adressage: 

On peut faire suivre un adressage ligne bien particulier par deux adressages colonnes successifs en utilisant deux validations de CASN, pour RASN actif constamment. Ce type de fonctionnement s'intitule mode page. Il est utilisé dans le TOB, par l'intermédiaire du gate array correspondant. 
Le rafraichissement de ces mémoires dynamiques se fait par adressages successifs des 512 lignes. 
Les 41256 ne sont pas sélectées (bus de données déconnecté) lorsque le signal CASN n'est pas actif. Ce dernier remplace avantageusement une commande de CHIP SELECT, 
Organisation générale 
La figure 18 montre deux plans mémoires distincts composés chacun de huit boîtiers 41256. Le plan supérieur représente les 256 Ko de mémoire vive résidant dans l'unité centrale, l'autre plan représente les 256 Ko de mémoire vive appartenant à l'unité d'extension, 

ChaqueboîtierreçoitencommunlescommandesdeRASNetRAMWNen provenance du gate array. CASIN et CAS2N autorisent la sélection des plans mémoire, conformément au tableau suivant par l'intermédiaire des commandes communes de CASN. 

Plan mémoiracetif 
Résident Extension Aucun 
Un bus de données RAMS est commun en entrée-sortie à tous les boîtiers des deux plans mémoire. Ce bus est en relation avec le bus de données du 6809 par l'intermédiaire d'un buffer 74 LS 245 commandé par le signal TRANSN selon certaines modalités. (cf.chapitre Ile6809 Edans leTO8, page 95). 
L'adressage de chaque boitier, nécessairement multiplexé en 2 x 9 bits, est issu du gate array mode page. Cet adressage physique sur 18 bits (AO à A17-256 Ko d'investigation) permet un découpage logique en pages de 16 Ko, selon une correspondance en espaces logiques de la carte mémoire limitée par principe à un adressage sur 16 bits (AO à A15-64 Ko d'investigation). Ces espaces logiques sont alors à considérer comme des banques mémoires, ce qui, vu d'un logiciel, ne change rien quant à l'ancienne structure du type TO9, mais est totalement différent au niveau matériel, 
Corrélativementàl'actiondugatearray,lestroisespacesmémoireRAM définis dans la carte mémoire ont chacun une correspondance en numéro de page dans un des deux plans physiques selon: 
Espace logique écran 
système données 
Espace physique page 0 
page 1 pages 2à 31 
plan résident
plan résident
plan résident ou extension 
Sélections et correspondances 
Contrairement au TO9, la sélection des zones mémoire qui était faite par aiguillage de CAS et bits de PIA est réalisée, dans le TO8, par un processus de transformation d'adresses. L'adressage logique, provenant de la programmation sur 16 bits, est transformé en 18 bits. 

La commutation de CAS1N et CAS2N est dépendante de la programmantion du gate array mode page (voir page 105) dans lequel cinq bits représentent le numéro de page. 
On remarquera, à la vue de ce tableau, une correspondance logique/physique beaucoup plus rationnelle que dans les montages précédents. 
Ecriture et lecture des RAMS 
Comme pour le TO9, deux cas de figure sont à considérer. «E= 1, phase active du 6809: 
Le microprocesseur peut communiquer en lecture ou écriture avec les RAMS à travler74sLS245parlebusdedonnées RAM.
La commande RAMW = R/WN. 
« E =0, phase non active du 6809: 
RAMW = 1, les mémoires sont en lecture automatique. Les lignes sont adressées en incrémentation constante par les compteurs du gate array. 

Afin de permettre leur rafraîchissement en deux temps, soit en accès mode page, les colonnes sont doublement adressées, avec un écart constant qui représente une variation de 8 Ko. Ainsi: 
Un premier accès a lieu dans la page physique 0 à une première adresse AD telle que: 
* 00000 < AD < O1FFF donc dépendantede la mémoire éctan B (couleur). 
Un deuxième accès a lieu dans la même page physique 0 à une adresse telle que: 
* 02000 < AD + 8 Ko < 03FFF donc dépendante de la mémoire écran À (points). 
Toute cette organisation est définie à partir du gate array "mode page”. 

5. Le gate array mode page CF 74021 
Ce nouveau circuit à réseau logique est une extension et une amélioration sensible du gate array principal utilisé dans le TO9. À lui seul, il assure en effet: 
— La distribution des signaux nécessaires à l'interface vidéo —Les décodages d'adresses 
— Les huit modes d'affichages
— Une nouvelle gestion des mémoires vives, dont le "mode page”
—Un fonctionnement polyvalent de commutation, d'adaptation et de changement de caractéristiques pour divers systèmes. 
Définition du mode page 
Dans le TO9, le gate array système est conçu de telle sorte que lorsque le CPU travaille dans la mémoire écran, son accès est dirigé, soit vers la RAMA (mémoirepointsouforme),soitverslaRAMB (mémoirecouleur)enfonction du bit de forme. Les circuits d'exploitation automatique (automate) de la mémoire écran permettent, quant à eux, la lecture simultanée des deux RAMS, Cette lecture est indépendante du bit de forme, afin de pouvoir élaborer en temps réel l'intégralité des signaux de visualisation destinés au tube cathodique d'affichage. 
Pour chaque groupe de huit pixels ou GPL affichés à I'écran, la circuiterie vidéo doit tire 16 bits en mémoire: 8 bits pour Yoctet "RAMA" et 8 bits pour l'octet "RAMB". Jusqu'à maintenant, cette lecture devait se faire en une seule fois, sur 16 bits, ce qui imposait à la mémoire écran, d'être organisée en deux bancs de 8 bits, alors que tout le reste de la mémoire système est sur un octet seulement. Cette organisation "irrégulière” n'est pas optimale économiquement et n'est pas favorable à l'utilisation des boîtiers mémoire dynamiques N x 1 bits qui sont pourtant les plus répandus, 
Afin de pallier cet inconvénient, le nouveau gate array dénommé "mode page” utilise un automate qui remplace l'accès 16 bits à la mémoire écran par deux accès successifs très rapides et qui totalisent la même durée que l'ancien accès 16 bits. 
Cette technique est rendue possible grâce à un mode d'adressage particulier des mémoires dynamiques: le mode page. Dans ce type de fonctionnement, plusieurs 

cases mémoires du composant peuvent être lues en séquence, à condition que ces cases appartiennent toutes à la méme rangée ou ligne de la matrice interne. 
Ainsi pour une adresse poids faible constante et un signal RASN à l'état bas, deux accès sont possibles pour deux adresses poids fort différentes en corrélation avec deux fronts descendants du signal CASN. 
Cette nouvelle structure implique donc une organisation nouvelle de la mémoire écran pour que les octets "RAMA" et "RAMB" soient accessibles en mode page. Evidemment, vu du logiciel, l'agencement de l'écran doit rester compatible avec les systèmes précédents, c'est-à-dire que le bit de forme doit toujours permetire de rendre l'accès du CPU, soit à la mémoire "écran A" soit à la mémoire "écran B". 
Gestion de la mémoire vive 
Cetie nouvelle version du gate permet de surcroît de gérer une quantité de RAM bien supérieure à celle implicitement contenue dans la carte mémoire. Ainsi est- il possible d'exploiter jusqu'à 512 Ko de mémoire vive par page de 16 Ko, Le numéro de page peut être choisi par programmation. 
De même ces pages "physiques” peuvent être affectées à plusieurs espaces “logiques” du système, tels que l'espace "cartouche”, l'espace "écran” et l'espace "données” (cf. gate array mode page dans ke TOS, page 117). 
D'un façon indépendante et de par une organisation très souple, un simple changement de programmation dans des registres rend possible I'adaptation du gate array mode page à diverses unités centrales (TO8, TO9+, MO6, MOSNR). De la même manière, divers types de mémoires dynamiques peuvent être cablés (4416, 4464, 4164, 41128, 41256 ou 44256). 
Structure du circuit 
La figure 19 schématise la structure interne du circuit à réseau logique prédiffusé. On y distingue: 
— Le décodeur d'adresses sollicité par le bus d'adresses du microprocesseur A15 - A0. 
— Le module des modes d'affichage avec ses deux registres programmables et son électronique en partie identique à ceux du gate array "mode d'affichage" dans le TO9. Conformément au mécanisme du "mode page”, dans ce module le transcodeur est attaqué en deux accès de huit bits, €n remplacement de l'ancien accés 16 bits RAMA RAMB. (Cf. analyse matérielle du TO9, p. 54.) 

— Le bus couleur en sortie du module. 

— Un circuit de génération RAMW (en logique câblée dans le TO9), combinaison de R/WN et E, afin de forcer une lecture automatique des mémoires vives pendant la phase non active du CPU, selon l'équation : 
RAMW=R/W+E 
Comme pour le TO9, (cf. étude matérielle, p. 48) on reconnaît l'autômate 
constitué:
— des compteurs points (avec C, RASN, E et Q), 

— des compteurs ligne et trame, (pilotés par H16 et CLRG), — et du bus de rafraichissement T12 - TO correspondant, 
H16 VCO est une nouvelle commande de remise en phase (cf. incrustation). 
— Les circuits de décodage et mixage délivrant les signaux vidéo SYNLT, SUPLT et INLT. 
— Un système de registre pour le crayon optique quelque peu modifié dans son exploitation et permettant notamment le contrôle de FIRQN anciennement assuré par un PIA. 
— Un double circuit de multiplexeurs commutant d'une façon classique les adresses CPU ou les adresses compteurs (phase du CPU en fonction de E); commutant en matriçage ligne et colonne (poids faible, poids fort en fonction de C); le tout, par l'intermédiaire du bus de neuf bits MAO-MAB destiné aux mémoires vives, 
En fait, un traitement ou aiguillage de signaux est effectué avant multiplexage. Cette action définit, entre autres, la génération des signaux CAS1N, CAS2N. Elle dépend de registres, dits de traitement, et programmables à souhait. C'est par là-même que résident l'originalié et la grande nouveauté du composant, voire du micro-ordinateur. 
Traitement des signaux multiplexés 

On voit apparaître selon les commandes d'horloge interne : 
Pour:—E=1(phaseactiveduCPU) —C= 1(adreRAsMsleignses) 
A7-AO = adresses poids faible du CPU; MUI6 représentant soit A8, soit les bits de commutation de banques BC2 ou BD2. 
Pour: —E = 1 (phase active du CPU) —C=0(adreRAMsscoleonsnes) 
A9-A12 = adresses poids fortdu CPU;
RAI3 = soitA13, soitlebitdeforme;
RAl4
= soitA14, soit les commutations de banques BCO ou BDO; RA15
= les commutations de banques BC1 ou BD1;
MU8
= soit les bits de commutation de banques BC2 ou BD2, soit A8; MUS = MU16 en commutation inverse;
RA17
= les commutations de banques BC3 ou BD3.
Pour:
— E = 0 (phase non active du CPU) -C=1(adreRsAMsleigsnes)
TO-T8 « adresses poids faible des compteurs. 
Pour: — E = 0 (phase non active du CPU) —C=0(adreRAMsscoleonsnes) 
T9-T12 = adresses poids fort des compteurs; 
TUB = soit T8, soit "0"; 
BEO, BE; Q 
On notera que pour ls condition E = 0, le système permet deux accès RAM, validés par deux fronts descendants de CASN (cf. gestion des mémoires vives) avecRASN àl'état0.Ladifférenced'adressageestreprésentéeparl'étatdeQqui, compte tenu du timing (quadrature avec E), délivre pendant la condition présente Tétat O et l'état 1. 
Q est en position de poids 13, ce qui représente une variation ou saut d'adresse de 21 = 8 Ko, les autres bits restant inchangés. Ainsi, quelle que soit l'adresse pointée, il existe systématiquement deux accès dans deux pages de 8 Ko conjointes. Ces deux pages sont concrétisées par la RAMA et la RAMB. 

Cette procédure réalise l'adressage automatique en mode page. On notera aussi que les signaux du type MU, TU, RA représentent des choix de commande imposés par programmation dans le registre de traitement afin de rendre compatible, comme nous l'avons précisé précédemment, le gate array avec le type de mémoires dynamiques et le micro-ordinateur choisis. 
BC, BD, BE et le bit de forme, quant à eux, sont des états directement programmables dans les registres de traitement, pour les commutations de banque, voire de page. 
Ainsi:
— BC3, BC2, BCI, BCO fixent e choix d'une banque de 16 Ko parmi 16 banques, pour recouvrir l'espace “cartouche”. 
- BD3, BD2, BD1, BDO fixent le choix d'une banque de 16 Ko parmi 16 banques pour recouvrir I'espace “données”. 
- BE1, BEO fixent le choix d'une banque de 8 Ko parmi 4 banques, pour recouvrir l'espace "écran”, 
Les registres de traitement 
En dehors de la gestion des mémoires vives, ces circuits offrent, en relation avec Les horloges et les décodages d'adresses, des possibilités multiples d'adaptation et de changement de caractéristiques selon les machines à concevoir, sans oublier pour autant la compatibilité avec les anciennes versions, 
Ces registres sont accessibles à des adresses bien particulières et par la commande du microprocesseur R/WN. Les adresses sont fondamentalement différentes selon que le composant travaille avec une unité centrale TO ou MO. La différence joue sur le digit hexadécimal de poids fort. 
Ainsi: Digit de poids fort = À en version MO Digit de poids fort = E en version TO 
Description etprogrammation des registres accessibles en écriture 
eRegistre "système 1"-adresse A7E7/E7E7 Organisation: 
D7 - bit de choix de l'utilisation du contrôleur de disque interne ou externe. En mode TO uniquement, ce bit a une influence sur les décodages d'adresses. 

D7=0 = contrôleur inteme D7=1 = contrôleur exteme 
D6 bit de gestion RAM dans l'espace cartouche. 
D6 = 0 = mode compatible nanoréseau
D6 = 1 = gestion par registre interne"cartouche" A7E6/E7E6. 
D5 - bit de standard d'affichage 
D5 =0 = 624 lignes (France) D5 = 1 > 524 lignes (Export). 
D4 -bit de gestion RAM dans l'espace "données”. 
D4 = 0 = gestion par bit de PIA (émulation) D4=1=gestionparregistreinterne:autorisel'écrituredalenresgistre"RAM 
données” en A7E5/E7ES. 
D3 et D2 - bits de choix du type d'ordinateur. 
D3=0 D2=0 = MO D3=0 D2=1 = TO9 D3=1 D2=1 = TO 
D1etDO-bitsdechoixdelaRAM dynamique 
D1=0 D0=0 = 256Kx1bit
= 25Kx64bits 
D1=1 D0=0 = 128 Kx1bit Di=1 D0=1 = 64 Kx4bits 
« Registre "systéme 2" -adresse A7DD/E7DD 
Ce registre est une combinaison de l'électronique de traitement et du registre définissant la couleur du tour ou cadre dans le module d'affichage. 
Organisation: 
D7 et D6 - bits indiquant le numéro de page physique à afficher sur l'écran (de 0 À 3 en binaire naturel). 
Avec 
D7=BEl D6=BE0 
cf. diagramme précédent page 108 
DS - bit pour masquer la cartouche, utilisable uniquement en mode MO, 
DS=0 = cartouche visible D5=1 = cartouche masquée. 
D4 —bit du BASIC à sélectionner, utilisable uniquement en mode MO. 
D4=0 = BASIC1 D4=1 = BASIC 128 
D3, D2, D1, DO - bits de la couleur du tour (cf. affichage). 
« Registre "RAM données” -adresse A7E5/E7E5 
Ce registre n'est accessible en écriture que si le bit D4 du registre "sysième 1" est écrit à 1. 
Organisation: 
D7 - bit d'autorisation d'accès au registre d'affichage en A7DC/E7DC en mode contrôleur de disque externe sélectionné (D7 de A7E7/E7E7 écrit à 1). 
D7=0 = écriture autorisée D7=1 = écriture inhibée. 
Le rôle de ce bit est dû au fait d'un risque de conflit, à l'adresse A7DC/E7DC, avec un éventuel contrôleur externe de QDD qui décode lui aussi cet octet. 
D6=0 D5=0 
D4, D3, D2, D1, DO - bits définissant le numéro de page RAM utilisée dans l'espace "RAM donnéesTM (de 0 à 31 en binaire natureD). 
Avec: 
D4 = Commutation de CASN 
D4=0 = CASIN valide D4=1 = CAS2N valide 
D3 = BD3
D2=BD2 cf. diagramme précédent, page 108 D1=BD1
DO=BD0 

Ainsi, en mode gestion de l'espace "RAM données”, D4-D0 donne le numéro de page physique de 16 Ko à affecter à l'espace logique. 
«Registre "cartouche” adresse A7E6/E7E6 
Organisation: 
D7=0 
D6—bitdeprotectionenécrituredanslapagedeRAM sélectionnéelorsque l'espace cartouche est recouvert par cette même page de RAM (D5 = 1). 
D6=0 = écriture impossible D6=1 = écriture autorisée. 
D5 
bit de sélection de l'espace cartouche. 
D5=0 =. l'espace cartouche n'est pas recouvert par de la RAM.
D5=1 — l'espace cartouche est recouvert par une page de RAM dont le 
numéro est donné par D4-DO. 
D4, D3, D2, D1, DO - bits définissant le numéro de page RAM utilisée dans l'espace cartouche (de 0 à 31 en binaire naturel). 
Avec:
D4 = Commutation de CAS, N 
D4=0 = CASIN valide D4=1 — CAS2N valide. 
D3 = BC3
D2=BC2 cf.diagramme précédent, page 108 D1=BCI
DO =BCO 
Ainsi, en mode de gestion de l'espace cartouche, D4-DO donne le numéro de page physique de 16 Ko à affecter à l'espace logique correspondant. 
«Registres "d'émulation” 
Ces registres viennent remplacer, pour D4 du registre système 1 = 0, l'action dévolue aux PIA (6846, 6821) des unités centrales TO7/70, TO9, MOS, par la commutation du bit de forme et des banques. Réagissant aux même adresses, ils sont ainsi parfaitement transparents pour l'utilisateur. Ils assurent une compatibilité totale dans l'emploi des anciens logiciels. 

« Registre de commutation "lecture traitement/crayon optique” adresse ATEA/ETEA. 
Ce registre est un peu particulier et ne rentre pas dans la catégorie des registres susnommés. Il est en effet destiné selon l'écriture du bit DO à aiguiller, pour des adresses semblables, la lecture de certains registres de traitement ou des registres crayon optique (latch). 
Ainsi:
DO=0 — sélection des registres de traitement (lecture) DO=1 — sélection des registres du crayon optique (lecture). 
Description des registres accessibles en lecture pour D0 = 0 (ATE4/E7E4) 
Excepté le registre "système 1", les registres de traitement, étudiés en écriture sont lisibles en entier ou partiellement, à des adresses différentes ou semblables. 
«Registre "système 2" -adresse ATE4/ETE4 
1permet une relecture partielle du registre écrit en A7DD/E7DD. Organisation: N 
D7 et D6 — bits indiquant le numéro de page physique affichée sur l'écran (de 0 à 3 en binaire naturel). 
D5 — bit de masquage cartouche en mode MO. D4 — bit de sélection du BASIC en mode MO. Les bits D3, D2, D1, DO sont à zéro. 
» Registre "RAM données” -adresse A7E5/E7E5 
Il permet la relecture du numéro de la page RAM, imposé en écriture, dans Fespace "données”. 
D7, D6,-D5 sont à l'état "0". 
«Registre "cartouche” -adresse A7E6/E7E6 
C'est le seul registre permettant une relecture complète des bits positionnés pendant la phase d'écriture à la même adresse A7E6/E7E6. Il permet notamment 

la relecture du numéro de page RAM, imposé en écriture, dans l'espace cartouche. 
Description des registres accessibles en lecture pour D0 = 1 (A7E4/E7E4) 
1 s'agit de quatre registres semblables à ceux du gate array système dans le TO9. 
# Registre "crayon optique 1" -adresse A7E4/E7E4 
Organisation: 
D7=TI2 D6=T11 D5=T10 D4=T9 D3=T8 D2=T7 D1=T6 DO=T5 
Avec T12 -TS, 8 bits de poids fort du compteur trame. 
«Registre "crayon optique 2" -adresse A7TES/ETES 
Organisation: 
D7=T4 D6=T3 D5=T2 D4=T1 D3=T0 
D2=E DI=H2 DO = H4 
Avec T4-TO, 5 bits de poids faible du compteur trame. 
Avec E-H4, bits du compteur point. 
« Registre "crayon optique 3" -adresse A7E6/E7E6 
Organisation: 
D7 - Bit significatif quand D6 = 0, c'est-à-dire, quand le spot est situé dans les bords droit ou gauche de l'écran. 

D7=0 =spotsituédanslaparticgaucduhcaedre. D7=1 — spot situé dans la partie droite du cadre. 
D6-Bitlatchédesituationfencêadrtereneligne(INILN). 
D6=0 = spot situé dans le cadre à gauche ou à droite. D6=1=spotsituédanslapartiehorizdeolafnenêtreadeltreavail. 
Cette valeur est latchée au moment de l'interruption de lecture crayon optique. D5, D4, D3, D2, D1, DO sont à l'état "0”. 
»#Registre "crayon optique 4" -adresse A7E7 ETE7 
Note: La lecture de ce registre est indépendante de l'état du bit DO (ATEA/ETEA), ce qui le rend toujours accessible. 
Organisation: 
D7 - bit instantané de situation fenêtre cadre en trame (INITN) 
    0. D7=0  = spot situé dans le cadre en haut ou en bas. 
    1. D7=1  = spot situé dans la partie verticale de la fenêtre de travail, 
D6- Bit latché de situation fenêtre cadreen trame (INITN). 
D6=0 = spot situé dans le cadre en haut ou en bas.
D6=1 =spotsituédanslapartieverdtelaifecnêtraedleteravail. 
D5 - bit instantané de situation fenêtre cadre en ligne (INILN) 
D5=0 — spot situé dans le cadre à gauche ou à droite.
DS=1 = spotsituédanslapartiehorizontadleelafenêdettraveail. 
D4, D3, D2 sont à l'état "0". 
D1 — bit de flag ou drapeau d'interruption de la demande FIRQN. 
D1=0 = pas de demande.
D1=1 = une interruptiaoénté générée. 
DO - bit de copie de DO écrit en A7E4.E7EA permettant de savoir quel type de registre est commuié en lecture. Ce bit est toujours accessible. 
DO=0=regisdettrraitemsent. DO=1 = regisdtercreaysonoptique. 

6. Le gate array "mode page" dans leTO8 
Afin de procurer l'adaptation nécessaire à l'unité centrale, certains bits des registres de traitement "système 1" doivent être verrouillés dans un état bien particulier. La description suivante met en relief les bits nécéssairement "figés” pour la configuration TO8, par rapport aux bits "X" commutables selon les fonctions ou standard à réaliser. 
Organisation du registre de traitement "système 1" en écriture -adresse E7E7 
XXxx0100 —— 
type RAM d'ordinateur 256 K x 1bit 
Ces conditions entraînent plus particulièrement: 
MUI6 = A8
MU8 = BC2,BD2 TU =0 
Les autres registres gardent la structure telle qu'elle est décrite dans le chapitre précédent, selon le répertoire suivant: 
Adresss R/W 
E7E4 0 ETE4 1 E7E5 0 B7E5 1 E7E6 0 E7E6 1 E7E7 0 E7E7 1 E7DD 0 E7DD 1 
Type de registre 
commutation ou système 2 crayon optique 1
RAM données
crayon optique 2 
espace cartouche crayon optique 3 système 1
crayon optique 4 système 2 affichage 

Diagramme des signaux multiplexés
Les conditions précédemment exposées déterminent le diagramme suivant: 
A0 BCLBDI1 Al BC2,BD2 
    2. A2  A9 
    3. A3  Al0 T3 T10 T10 
    4. A4  All T4 Til TH 
As Al2 T5 T12 TR 
    6. A6  Al3,forme T6 Q=0 Q=1 
    7. A7  BCO,BDO T7 BEO BEO 
TO BEIl BE1 T1 0 0 
T2 T9 T9 
A8 BC3,BD3 T8 0 0 Ligne Colonne Ligne Col.l Col.2 
Les éléments de ce diagramme sont à considérer dans l'ordre des poids respectifs selon la forme: 
Commutation
des banques dans
l'espace cartou- Commutation mémoires écran RAMA, RAMB che ou données 
1l convient de rappeler que le bit D4 dans le registre "RAM données” et dans le registre "espace cartouche”, de par sa position, joue indirectement le rôle d'un dix-neuvième bit d'adressage par le truchement de CASIN et CAS2N. 
De par ce fait, on peut donc considérer que le système est capable d'adresser un plan mémoire de 512 Ko constitué lui-même de deux plans mémoires de 41256 (résident et extension) et dont les adresses iraient de 00000 à 3FFFF pour D4 = 0, soit CASIN =0 et de 40000 à 7FFFF pour D4 = 1, soit CAS2N = 0. 
Commutation @
des banques Commutation mémoires écran RAMA, RAMB dans l'espa-
ce écran 
On désigne ce type d'adressage comme provenant d'un automate.

Association entre adressage logique et adressage physique 
Pour des raisons de compatibilité évidente, nous savons que l'ensemble du système, vu du logiciel, conduit à la détermination de quatre espaces d'adressage logique distincts: 
l'espace "cartouche”
l'espace "écran” (page 0)
l'espace "système“ (page 1 fixe) Tagpace "données” (pages des banques). 
De par la programmation du gate array et la transformation de l'adressage tésultant sur le bus multiplexé MA8-MAO, une page physique, c'est-à-dire 16 Ko d'un plan mémoire 41256, peut être affecté à un espace logique donné. Le comportement individuel de chacun des espaces logiques est spécifié dans ce qui suit (cf. figure 20 page suivante). 
Espace "cartouche” 
Cet espace situé entre 0000 et 3FFF contient normalement de la ROM sous forme de mémoire interne (BASIC 1, BASIC 512) ou de mémoire externe (cartouche). 1 est néanmoins possible d'affecter une page de mémoire vive à cet espace logique (recouvrement) en mettant le bit DS du registre gate array (E7E6) à l'état 1. Dans ces conditions, CSCRTN est dévalidé et les 41256 reçoivent CASIN ou CAS2N. (cf. gestion de la mémoire morte, page 96). 
La correspondance entre l'adressage CPU et l'adressage multiplexé est immédiate pour les bits AO à A13, Elle se présente sous la forme suivante: 
Adressage logique CPU (16 bits) 
7/e,

Adressage physique transformé (18 bits) 4————\ BC3 BC2 BC1 BCO A13 A12 A11 A10 A9 A8 A7 A6 A5 A4 A3 A2 A1 A0 
L'adressage transformé permet un recouvrement par une des 16 pages d'adresses de 00000 à 3FFFF pour CASIN = 0 du plan mémoire résident et, par 16 pages d'adresses de 00000 à 3FFFF pour CAS2N = 0, du plan mémoire extension. 

ESPACE MONTEUR 

Découpage togique {carte memoire G4kKo) 

CPU

AUTOMATE 
Espace "écran” 
Cet espace, situé entre $4000 et S7FFF, contient deux banques de 8 Ko (RAMA ou mémoire point, RAMB ou mémoire couleur) utilisées par l'automate pour synthétiser l'image affichée. Par défaut, c'est la page O qui est affichée, mais il est possible de demander à l'automate d'afficher les pages 1, 2 ou 3, 


Découpage physique  
Le principe est le suivant 
— Après un RESET, une mise sous tension ou si les bits D7, D6 du registre situéenE7DDsonttouslesdeuxà0,c'estlapagephysiqueOquiestaffichéeà T'écran, La façon dont les données sont interprétées par l'automate d'affichage dépend alors du mode choisi. 
— En reprogrammant les bits D7 et D6 de E7DD, on peut afficher les pages physiques 1, 2 ou 3. Si on demande l'affichage de ia page 1, c'est le contenu de laRAM "système” qui apparaitra àl'écran. Ce contenu ayant peu d'intérêt, ce sont surtout les pages 2 et 3 qui seront utilisables. 
— Lorsque le CPU accède à l'espace logique d'écran, c'est toujours la page physique O qui est adressée, même si l'automate d'affichage utilise une autre page. Dans l'espace logique d'écran, le CPU utilise le bit "FORME" pour travailler dans la mémoire RAMA (point) ou RAMB (couleur), de par la programmation en émulation du bit DO en E7C3. 
— Si le CPU veut accéder aux pages 2 et 3 en les considérant comme des écrans, ildoitlesaffecteràsonespaceRAM“données”afindepouvoirleslireoules écrire.Danscecas,ondoitconsidérerquelamémoireRAMA(point)setrouve aux adresses hautes de la page, tandis que les adresses basses contiennent les informations RAMB (couleurs); en effet, le bit FORME traditionnel est inopérant dans l'espace "données”. 
— La page affichée par l'automate peut être en même temps affectée à l'espace “données”, voire à l'espace "cartouche”. De par le principe énoncé, si on veut par exemple afficher la page 2, dans laquelle le CPU puisse faire une mise à jour, il faudranécessairementaffecterlapage2àl'espaceRAM"données”quisera considérée alors comme la nouvelle mémoire écran; et demander à l'automate d'afficher la page 2, en programmant les bits D7 D6 en E7DD respectivement à 1et0. 
Espace "système” 
Cet espace logique situé entre 6000 et 9FFF contient les informations vitales à l'unité centrale, telle que la page O du moniteur. Cet espace n'est pas reconfigurable, on dit qu'il est fixe. C'est la page physique 1 du plan mémoire 41256 qui y est constamment affectée. Aucun registre ne nermet de reprogrammer cet espace. 
Espace "données” 
Cet espace logique est situé entre A000 et DFFF. Sur TO9 et sur TO7/70 cet espace était géré en "bank switch" à l'aide des bits de PIA qui permettaient de choisir une page physique de 16 Ko parmi six. Toujours pour des raisons de 

compatibilité, cette technique est ici totalement émulée par le gate array mode page. L'écriture et la lecture des cinq bits de PIA se font identiquement. Pour obtenir ceite émulation, il faut que le bit D4 du registre E7E7 soit mis à 0. Ceci est obtenu par défaut au RESET et à la mise sous tension. 
Nous savons qu'un deuxième mode est disponible en mettant à 1 le bit D4 de E7E7. Dans ce mode, il suffit d'écrire le numéro (de O 31) de la page physique souhaitée, par les bits D4-DO du registre E7ES, pour que la page concemée soit affectée à l'espace "données”. Ainsi la gestion de la mémoire s'en trouve simplifiée puisqu'une simple écriture de numéro de page suffit à effectuer le recouvrement. La correspondance entre l'adressage CPU et l'actressage multiplexé est immédiate pour les bits A0 à A13. Elle se présente sous la forme suivante: 
Adressage logique CPU (16 bits) —nn= 
A13 A12 Al1 A10 A9 AB A7 A6 AS A4 A3 A2 Al AO 
Adressage physique transformé (13 bits)
Le — —- BD3 BD2 BDI BDO A13 A12 A11 A10 A9 A8 A7 A6 A5 A4 A3 A2 A1 A0 
Comme pour l'espace cartouche, l'adressage transformé permet le recouvrement des deux plans mémoire de 256 + 256 = 512 Ko par l'intermédiaire du CASIN et CAS2N en relation avec le bit D4. 1l faut noter cependant que de par la transposition schématisée ci-avant, il existe une distorsion entre les deux adressages qui se manifeste dans le champ A15-A12. Ainsi, en prenant par exemple un recouvrement par la page 2: 
BD3=0 BD2=0
Adresse logique 
A000-AFFF B000-BFFF C000-CFFF DO00-DFFF 
Adresse physique 
3= tranche de 4 Ko 4= tranche de 4 Ko 1 tranche de 4 Ko 2 tranche de 4 Ko 
Cette transposition n'a pas d'importance tant que l'on ne transfere pas d'information de l'espace "données” vers les autres espaces. Si on opère des transferts, il faut alors tenir compte des correspondances. 
Par déductionla correspondance entre espace "cartouche” et espace "données” est la suivante: 
Espace "données” 
A000-AFFF B000-BFFF C000-CFFF D000-DFFF 
Espace "cartouche“ 
2000-2FFF 3000-3FFF 0000-0FFF 1000-1FFF 
De même, la correspondance entre espace “données” et espace "écran” est telle que: 
Espace "données” Espace "écran” 
A000-BFFF RAMB C000-DFFF RAMA 
La correspondance entre espace "cartouche” et espace “écran” est donc quant à elle: 
Espace "cartouche” Espace "écran” 
0000-1FFF RAMA 2000-3FFF RAMB 
On notera pour terminer que les six pages accessibles par bits de PIA, selon l'ancien mécanisme, correspondent aux pages 2 à 7 selon le-nouveau système. 
On en déduit 
Ancien sysième Nouveau système page 
Au RESET, la gestion par bits de PIA étant prise par défaut, c'est la page physique2quiestaffectéeàl'espaceRAM "données”. 
Gestion de l'affichage 
La procédure d'affichage sur l'écran est sensiblement identique à celle du TO9 (cf. étude matérielle du TO9, page 54). Le gate array mode page intègre la totalité de la circuiterie vidéo capable de gérer les différents modes d'affichage connus sur le TO9. Il est prévu pour piloter directement une palette externe, 
Selon les modes d'affichage, les couleurs imposées en configuration de base diffèrent de celles connues sur le TO9. Le bit S (saturation) est notamment remplacé par le bit P (pastel). 
En debors du bit DS du registre "système 1" en E7E7 qui permet de définir 1e standard 624 lignes (système européen) ou 524 lignes (système NTSC), un registre spécial appelé registre "affichage”, situé en E7DC, contient les bits de programmation essentiels de l'affichage. 
Ce registre d'affichage est identique à cetui du TO9 (cf. sysième de visualisation du TO9) et, de la même manière, permet de décider: 
— du mode d'affichage
— de la fréquence pixel
— de l'organisation relative des bits à l'intérieur des données vidéo extraites de la mémoire, 

Cette procédure est récapitulée par le tableau suivant:
D7 D6 DS D4 D3 D2 Dl D0 Mode
0 TI TO & @ C B A 
TO7
&0o¢0000 bitmap4
o0100001 bit map 4 spécial
o10006001 80colonnes
¢010101O bitmap16
o1111011 page!
0010010O page2 60100101 surimpression 0o 0 1 0 0 1 1 0 triple surimpression 0 0 1 1 1 1 1 1 
organ. frég. mode pixel 
La consultation de ce tableau permet de voir qu'il existe un neuvième mode d'affichage non utilisé sur le TO9, le mode bit map 4 couleurs spécial. LeschémadecodageettranscodageenRAMestlesuivant: 
Mode bitmap 4(rapel) 
RAMA
C7 C6 CS C4 C3 C2 C1 CO 
RAMB
C7 C6 C5 C4 C3 C2 CI CO 
définition du rouge R
Après transcodage ==> mode bitmap4spécial: 
définition du vert V 
C7 C7 C6 C6 C5 C5 C4 C4 C3 C3 C2 C2 C1 C1 CO CO RVRVRVRV RVRVRVRV 
Dans ce type de codage, un point est représenté par deux bits consécutifs du même octet. Cette organisation présente un intérêt pour certaines routines graphiques; toutefois, il faut noter qu'elle n'est pas employée par les routines du moniteur. 
Gestion des couleurs du cadre 
La couleur du tour de l'écran est programmable directement par le registre “sysiéme 2" en E7DD, par les bits D3 à DO, selon une organisation semblable à celle du TO9, exception faite pour le bit S (saturation) qui devient P (pastel). 
D3 D2 DI DO PBVR 

Les décodages d'adresses 
Le gate array mode page génère directement un certain nombre de signaux destinés à sélectionner les différents ROMS et périnhériques. Ce sont: 
CSMN — = sélection de l'espace moniteur CSCRTN = sélection de l'espace cartouche 
Cs32
E7CXN = CSPALN = EXXXN = DISN = 
sélection de 32 octets (FFDO-FFEF)
sélection de la zone des 6821 et 6846 sélection de la palette
sélection périphériques extemes
sélection du contrôleur disque (E7D0 àE7D9) 
Les signaux CS32, E7CXN, CSPALN sont décodés par une simple logique combinatoire et sont toujours valides. Les autres signaux dépendent de la programmation de certains registres et leur comportement est détaillé ci-après. 
Sélection de l'espace moniteur CSMN 
Le moniteur système du TOB est situé de l'adresse E800 à FFFF. L'espace utilisé par le moniteur du drive (floppy ou QDD) est placé de E000 à E7AF. Les deux moniteurs faisant partie intégrante d'une même ROM, c'est le même signal qui est validé sur l'ensemble : 
[É000 - E7AF] U [E800 - EFFF]. 
Par ailleurs, il est possible en programmant le bit D7 du registre "système 1" en E7E7 à l'état 1, d'installer un contrôleur de mémoire de masse externe. Dans ce casdefigure,CSMN n'estplusvalidédeE000àETAF. 
Tl est à signaler que l'espace moniteur contient un "trou” de 32 octets situé en FFDO et FFEF qui sant réservés aux décodages d'extensions futures (rôle de CS32 en relation avec le connecteur extension). Dans cet espace, CSMN = 1. 
Sélection de l'espace cartouche CSCRTN 
L'espace logique réservé aux logiciels externes (cartouche) ou interne s'étend de 0000à3FFF.IlpeutêtrerecouvertpardelaRAMenpositionnantlebitD5du registre "espace cartouche” à l'état 1. Dans ce cas, CSCRTN qui est normalement validé passe à l'état 1, supprimant, par là-même, toute communication avec les ROMS. 

Sélection de la zone des périphériques externes EXXXN 
Le signal EXXXN sort du gate array “mode page” pour aller vers les connecteurs d'extensions de l'unité centrale où il est utilisé par les périphériques pour leur décodage. 
Il permet, entre autre, d'effectuer un prédécodage d'adresses dans le cas où l'utilisateur désire se fabriquer sa propre extension, Ce dernier devra alors impérativement loger son interface dans l'espace mémoire E7B0 à E7BF. 
Comme dans le TOB, un bon nombre d'adresses correspondant à la zone EXXX sont déjà exploitées, il faut donc que le signal cormespondant soit non valide quand il y a risque de conflit entre un périphérique extérieur et l'unité centrale. 
Les possibilités de conflit diffèrent selon l'utilisation ou non d'un contrôleur exteme. 
En utilisation normale (D7 du registre "système 1" = 0), EXXXN est invalidé sur l'ensemble: 
[E000 -E7AF] U [E7D0 -E7D9], 
En utilisation d'un contrôleur externe (D7 = 1), EXXXN reste valide à ces endroits. 
De même, une souplesse de programmation est laissée pour l'octet E7DC qui peut être à la fois employé en temps que registre d'affichage ou par un contrôleur externe de QDD. 
SilebitD7duregistre"données”enE7ESestécritàO,alorsEXXXNn'estpas valide à l'adresse E7DC; sinon EXXXN reste valide à l'adresse E7DC mais on ne peut plus accéder au registre d'affichage. 
L'ensemble des adresses [E7DA -E7DB] U [E7DD -E7DF] invalide toujours le signal EXXXN car elles correspondent àlapalette etcertains registres protégés. 
Sélection du contrôleur du DRIVE DISN 
Ce signal n'est valide sur [E7DO -E7D9] que si le bit D7 du registre “système 1" (E7E7) = 0, déterminant alors l'utilisation du contrôleur interne. 

Tableau récapitulatif 
Avec D77 bit du registre "système 1" en E7E7 pour le contrôleur externe. Avec D75 bit du registre "RAM données" en E7ES pour le choix d'un QDD. 
D77=0 D75=0 
Espaces 
CSMN 
D77=1
D75=0 D75=1 
EXXXN DISN CSMN EXXXN DSIN EXXXN 
E000-E7AF 0 1 1 1 0 1 0 
ETBO-ETCF 1 0 1
E7D0-E7D9 1 1 0
E7DA-ETDB 1 1 1 1 1 1 1 
E7DC 1111110 E7DD-E7DF 1 1 1 1 1 1 1 
E7E0-E7FF 1 0 1
ES00-EFFF Q 1 1 0 1 1 1 
contrôleur contrôleur externe interne 
Gestion du crayon optique 
Le fonctionnement de l'interrupteur du crayon optique est assuré de la même manière que sur le TO9 (cf. gestion du crayon optique, page 82), 
Pour la gestion du photo-transistor, via un circuit à miroir de courant, le signal CKLPN est récupéré par le gate array mode page qui intègre la demande d'interruption FIRQN établie anciennement par le 6821 dans le TO9. En dehors de cette particularité, le fonctionnement reste pratiquement semblable et le gate array mode page offre, comme son successeur, la possibilité de faire des mesures avec la résolution du point. 
Nous savons que quatre registres permettent de lire les informations afférentes à une mesure light-pen; ce sont : 
en E7E4 - le registre crayon optique 1 en E7ES - le registre crayon optique 2 en E7E6 - le registre crayon optique 3 en E7E7 - le registre crayon optique 4 

1010 1010 
1010 QDD 
En écrivant le bit DO de E7E4 à 1, on se prépare à pouvoir lire ces registres et, par la même occasion, on autorise le passage du signal arrivant du crayon optique lui-même vers la sortie ITLP du gate array reliée à I'entrée FIRQN du CPU. On "arme” donc la routine light-pen en rendant le CPU interruptible par les signaux de mesure en provenance du crayon optique. L'arrivée d'une impulsion de mesure CKLPN provoque une FIRQN sur le CPU et latche le contenu du compteur 16 bits associé. La valeur du compteur désigne alors le pixel "vu" par le crayon optique. Le CPU peut alors lire le contenu de ce compteur par les registres E7E4 et E7ES. 
— E7EA donne les 8 bits de poids fort: T12 T11 T10 T9 T8 T7 T6 TS
— E7ES donne les 8 bits de poids faible: T4 T3 T2 T1 T0 E H2 H4 
Les 3 bits E, H2, H4 issus d'un com}‘)lmge à 8 MHz donnent la résolution du pixel dans les modes 320 x 200 et d'un pixel sur deux en mode 80 colonnes. D'autres informations complétant la lecture de ces compteurs sont disponibles dans les deux autre registres (cf. Description des registres accessibles en lecture pour D =0, page 114). 
Au moment de l'arrivée de CLKLPN, un drapeau d'interruption est levé dans le bit DI du registre E7E7. Ceci permet de vérifier que l'interruption FIRQN a bien été causée par le crayon optique. 
La lecture des poids faibles du compteur light-pen (E7E5) a pour effet de relâcher la ligne FIRQN et d'abaisser le drapeau d'interruption dans le registre E7E7. Dès que cette lecture est effectuée, le gate array est donc prêt à effectuer une autre mésure. 
L'organisation du gate array mode page permet donc d'implémenter une routine de mesure du crayon optique similaire à celle qui existe sur le TO9 (cf. étude matérielle du TO9, gestion du crayon optique, page 82). 

7. Chaîne de visualisation 
Le gate array "mode page” génère les informations R, V, B, P et HP nécessaires
au circuit de palette IGV EF 9369 d'une façon parfaitement identique au TO9 (cf. Le système de visualisation du TO9, page 52). Ce circuit remplit bien évidemment les mêmes fonctions (choix de 16 teintes parmi 4096, choix de la couleur d'incrus-tation) et se programme de la même manière. 
Les trois sorties analogiques R, V, B attaquent, d'une façon toujours identique au TO9, la prise péritel à travers un circuit d'adaptation et un mélangeur recevant le signal SYNLT pour reconstituer une vidéo composite. 
Les trois sorties sont dérivées vers un adaptateur pour un éventuel modulateur PAL (version EXPORT), 
Le circuit d'incrustation, bien que semblable à celui du TO9 dans son principe (c£. Circuit d'incrustation du TO9, page 71), diffère par sa conception. En effet, le gate array "mode page" possède une entrée spéciale (16MHz VCo) de remise en phase, ce qui, en demande d'incrustation, ne nécessite pas une décommutation de I'horloge mère, 
La figure 21 concrétise le fonctionnement général du dispositif. 
Ainsi en fonctionnement normal (après mise sous tension ou RESET) le bit CB2 du PIA système est à l'état 1. Le transistor T14 est saturé et le transistor TO6 est bloqué. Le 12 V apparaît en commande de commutation lente et force par la diode D4 et la conduction du transistor TOS la commande de commutation rapide. Le bit marqueur en provenance du circuit de palette est inopérant, Iz diode D7 étant bloquée. 
En fonctionnement incrusté, après mise à l'état 0 de CB2 par programmation, le transistor T14 est bloqué, entraînant la saturation du transistor TO6. La commande de commutation lente devient inactive (O V). Le bit marqueur, protégé par la diode D4 constamment bloquée, devient maître d'œuvre pour envoyer la commande de commutation rapide à travers TOS5, selon 1a procédure connue sur le TO9: 
couleur hors incrustation ==> M = 1==> commutation rapide couleurd'incrustation|==>M=0—>pasdecommutationrapide 

Le boîtier d'incrustation branché, le gate array reçoit la commande de remise en phase ligne par l'intermédiaire du 16 MHz VCo. Il regoit la commande de remise à l'heure trame par l'intermédiaire de CLRG. 
TELEVISEUR 
BOMER EXYENSION INCRUSTATION 
Traitoment 
o7 M
D4 1 
Tos 
6821 cB2 
azv 
GATE ARRAY MODE PAGE 
UNITE CENTRALE 
Tos
T14 

8. Les interfaces 
Le TO8 comprend quatre circuits d'interface pour gérer ses divers périphériques (un 6846, deux 6821, un 6804), Certains bits restent compatibles pour le TO9, ce qui est mis en évidence dans la description suivante, 


Switch crayon optique Cartouche 
Banque moniteur ACK (clavier) BUSY {imprimante} LEP (réception} 
LEP (émission) 
Comme pour le TO9, la partie mémoire morte de ce boîtier complexe n'est pas utilisée (adressage sur 4 bits de AO à A3). 

Partie PIA 
Le port 8 bits a, par initialisation, trois lignes P2, P4, P5 configurées en sortie et trois autres lignes P1, P6, P7 en entrée. Le bit PO, bien que configuré en sortie, n’est pas utilisé matériellement (broche non connectée). En fait, l'action de ce bit est émulée dans le gate array "mode page” (cf. Le gate array mode page CF 7021, page 105) pour la commutation du bit de forme. 
- Le bit P1, comme pour le TO9, assure la lecture de l'état de l'interrupteur du crayon optique (0 => interrupteur ouvert, 1=> interrupteur fermé). 
- Le bit P2, incompatible sur le TO9, commande la commutation cartou- che/logiciels internes (cf. Sélection entre logiciels résidents et cartouche, page 98). 
— Le bit P3 n'est pas utilisé (ancienne commande LED clavier TO7, TO7/70). 
— Le bit P4, incompatible sur le TO9, détermine la sélection de page moniteur (cf. Sélection d'une page moniteur, page 98) avec: 
0 ==> partie basse. 1 ==> partie haute. 
— Le bit PS5, incompatible sur le TO9, envoie le signal ACK (acknoledge-accusé de réception), en retour d'une communication du clavier (cf. Le 6804, page 138). 
— Le bit P6, incompatible sur le TO9, reçoit l'information BUSY (indicateur d'occupation) de l'imprimante CENTRONICS avec: 
0 ==> imprimante occupée
1 ==> imprimante disponible 
— Le bit P7 réceptionne, comme pour le TO9, les informations numériques décodées en lecture du LEP. 
Les lignes de contrôles, incompatibles avec celles du TO9, assurent pour: 
— CP1: La réception des données en transmission série, provenant du clavier via le 6804. Chaque bit est codé selon une temporisation récupérée en demande IRQN par le 6809 E (cf. fonctionnement du 6804). 
— CP2: initialisée en sortie, envoie la commande "MUTE" procurant un blocage du son (action sur un transistor du mélangeur) lorsque l'utilisateur manipule la souris: 
0 ==> passage du son 1 ==> blocage du son 

Partie TIMER
D'une façon identique au TO9, la sortie CTO génère l'écriture cassette, 
Adresses des registres internes 
E7CO - registre d'état composite
E7CI - registre de contrôle périphérique 
    2. E7C2  -registre de direction de données 
    3. E7C3  - registre de données périphériques 
    4. E7C4  - registre d'état composite 
    5. E7C5  -registre contrôle temporisation 
    6. E7C6  -registre temporisation 
Le 6821 système 
Commanda Moteur LEP KTEST clavier 
Imprimante CENTRONICS 
STROBE imprimante Incrustation 


Àl'exceptiondeCB1recevantparlabroche5duconnecteurcrayonoptique,une éventuelle demande en code barre, et des bits PB7, PB6, PBS, PB4, PB3 de commutationbanqueRAMsurleTO9,dontl'actionesticiparfaitementémulée par le gate array “mode page” (les broches sont “en l'air“), le composant joue le même rôle que dans l'unité centrale du TO9 (cf. Utilisation du 6821 dans le TO9, page 75). 
Adresses des registres internes 
E7C8 -registre de direction de données ou registre de données partie À E7C9 -registre de direction de données ou registre de données partie B E7CA -registre de contrôle partie À
E7CB - registre de contrôle partie B. 
Le 6821 jeux et musique 
Ce boîtier a, de par l'initialisation, toutes ses lignes en entrée. La quasi-totalité des lignes assume l'exploitation des manettes de jeux ou de la souris. Lorsque l'unité centrale doit émettre un message sonore, six bits du port B sont alors commutés en sortie pour attaquer, après bufferisation, un convertisseur numérique analogique du type CNA R/2R dont la sortie est reliée au mélangeur recevant par ailleurs une éventuelle information audio, après lecture du LEP. 
Description des broches 
—Port A 
Quatre lignes sont consacrées à la manette de jeux "0", ou à la souris, par l'intermédiaire du connecteur B12 (prise avant) avec: 
PAO — contactnord PAI — contactsud 
    2. PA2  — contactouest 
    3. PA3  contactest 
— ou gachette 1 — ou gachette 2 
ou XB ouYB 
Les quatre autres lignes sont consacrées à la manette de jeux "1" par l'inter- médiaire du connecteur B13 (prise arrière) avec: 
PA4 PAS PA6 PA7 
— contact nord — contact sud 
— contact ouest contactest 

*Bus connées 

Chaque ligne a un rôle complexe: 
PBO commun bufferisé pour la manette de jeux "0" ou bnt 0 configuré en sortie pour leCNA. 
    1. PB1  commun bufferisé pour la manette de jeux "1" ou bit 1 configuré en sortie pour le CNA. 
    2. PB2  bouton d'action B de la manette de jeux "0" ou XA de la souris ou bit 2 configuré en sortie pour le CNA. 
    3. PB3  bouton d'action B de la manette de jeux "1" ou bit 3 configuré en sortie par le CNA. 

6845 
PB4 bit 4 configuré en sortie pour le CNA. 
PBS bit 5 configuré en sortie pour le CNA. 
PB6 bouton d'action À de la manette de jeux "0” ou YA de la souris. 
PB7 bouton d'action À de la manette de jeux "1°. 
Les lignes de contrôle CA1, CA2, CB1, CB2 peuvent être utilisées conjointe- ment en demande IRQN pour les boutons d'action ou la souris selon: 
CAI bouton d'action B pour la manette "0" CA2 bouton d'action A pour la manette "0" CB2 bouton d'action À pour la manette "I" CB1 bouton d'action B pour la manette "1". 
De par l'emploi des mêmes connections pour l'élaboration du son et pour lutilisation de la souris, il est nécessaire, pour ne pas être gêné par un bruit parasite à chaque manipulation, de bloquer la sortie son. Cela est réalisé par le bit CP2 du PIA 6846 (0 sortie son validée - 1 sortie son invalidée) qui vient agir sur Je mélangeur, 
Adresses des registres internes 
E7CC - registre de direction de données ou registre de données partic À E7CD - registre de direction de données ou registre de données partie B E7CE - registre de contrôle partie À
E7CF - registre de contrôle partie B. 



Interfaçage du clavier 
La figure 25 montre les interconnexions entre la matrice 10 x 8 du clavier et les ports A, B et C du 6804, Ce dernier est piloté par un quartz à la fréquence de 
11 MHz. 
Fonctionnement 
Comme pour le TO9, c'est le clavier qui indique au 6809 E qu'une touche vient d'être appuyée. La transmission est réalisée par un dialogue entre les deux microprocesseurs via trois bits de PIA: ‘ 
— CP1 du 6846, pour les données à transmettre
— PS du 6846, pour la reconnaissance d'une touche du clavier (ACK),
— PAO du 6821 système pour la reconnaissance du périphérique (KTEST). 
« Emission d'une donnée par ke microprocesseur "clavier":
Les données émises par le microprocesseur "clavier” se composent de 9 bits: 
ler bit: 2ème bit: 
Touche CNT enfoncée ->1 Touche CNT libre ->0 
Touche SHIFT enfoncée oùu
CAPS LOCK actionné ->1 Touche libre et
CAPS LOCK non actionné ->0 
7 bits suivants: Numéro de la touche de 0 à 79 (contrairement au TO9 et TO9 +, ce n'est pas le code ASCII de la touche qui est envoyé, mais seulement Je numéro de la touche, le trancodage numéro 
--> code ASCII étant à la charge du 6809 E). 
Corrélativement avec KTEST, pour prévenir le 6809 E qu'il va recevoir une information du clavier, le 6804 descend le bit PC3 à 0, ce qui provoque une interruption par le bit CP1 du 6846. I attend ensuite que le 6809 descende le fil P5 du 6846 à O, lui indiquant qu'il est prêt à recevoir les 9 bits de données (signal ACK). 

Les informations séries transmises répondent à la convention suivante: 
— un 1 logique est codé comme étant une impulsion positive de 56 microsecondes,
- un 0 logique est codé comme étant une impulsion positive de 38 microsecondes. 
Dans l'exemple de la figure 25, la touche CNT est enfoncée en même temps que la touche "U" du clavier "métropole” dont le code est 32 en hexadécimal. 
« Emission d'une requête au clavier par le 6809 E: 
Le 6809 peut émettre 3requêtes différentes au 6804: 
Initialisation: Le 6804 renvoie alors au 6809 E, un code indiquant que le clavier est configuré en version Française ou Export. Le clavier se met en CAPS LOCK actif -LED allumée. 
Majuscule: Le clavier se met en CAPS LOCK actif -LED allumée. 
Minuscule: Le clavier se met alors en CAPS LOCK inactif -LED éteinte. 
Quand le 6809 E souhaite émettre une requête, il met P5 à O et attend que le 6804 descende de fil PC3 à 0, le 6804 compte alors le temps pendant lequel P5 reste à 0. Le 6809 E peut donc générer trois temporisations différentes correspondant aux trois requêtes possibles: 
— 0,67 milliseconde --> demande d'initialisation du 6809 E — 1,30 milliseconde --> mise en CAPS LOCK actif
— 1,90 milliseconde --> mise en CAPS LOCK inactif. 

9. Le contrôleur de l'unité de disquette . 
Le contrôleur de drive du TO8 est un nouveau boitier gate array THMFC1 développé par THOMSON Micro-informatique, pour répondre aux besoins des nouvelles machines. Il présente, notamment, une adaptabilité aux différents formats d'enregistrement des données (codage FM et MFM) et à la gestion des floppies 3"5, 5"25 ou d'un QDD (Quick Disk Drive). 
1 peut commander deux unités de disquettes à la fois. D'un point de vue externe, le THMFCI s'apparente au WD 2793 ou WD 1770 utilisés sur le TO9. En interne, il se distingue par l'emploi d'un séparateur de données utilisant la technique de comptage à la place d'un circuit à verrouillage de phase (PLL). De même, il intègre un registre du choix de codage simple ou double densité (FM, MFM). 
Branchements du THMFC1 
En liaison directe avec le bus du 6809 E (figure 26), le contrôleur est connecté au bus d'adresses par les trois lignes A2, Al, AO. Ces trois bits, en relation avec le décodage d'adresse DISN (actif pour E = 1) dans l'espace E7DO à E7D9, et en relation avec la commande R/WN (retardée en lecture), permetient la sélection des onze registres dont dispose le composant, 
La figure 26 décrit les différentes commandes concemant les unités de disquettes. 
On distingue: 
— La commande MO du moteur de drive (non utilisée pour le QDD). Elle est en. liaison avec la sélection du contrôleur qui, via un monostable redéclenchable, avec une constante de temps de plusieurs secondes, intègre les demandes d'accès et procure une inertie suffisante du moteur adaptée pour le bon fonctionnement du mécanisme. 
— READY est une information en retour de la mécanique confirmant l'insertion de la disquette, la mise en route du moteur, la fréquence d'index correcte. Cette commande permet de valider, dans le contrôleur, les actions de lecture et d'écriture. 
Des commandes bufferisées par un 74 LS 07 délivrent: 
— Les signaux de commande mécanique du drive: 
STEPN Pour déplacer la tête de lecture/écriture d'un pas. Cette commande est inutilisée dans un QDD. 
DIRN Pour indiquer 2 la mécanique dans quel sens déplacer 1a tête (0 vers le centre, 1 vers l'extérieur). 
WGN Le signal d'autorisation d'écriture.
WDN Flotdedonnéessériesd'écrituredeladisquette. DSON DSIN _ Les signaux de choix du drive. 
Le signal SIDEN bufferisé par un transistor indique à la mécanique sur quelle face de la disquette travailler (0 face supérieure, 1 face inférieure).
Pour le QDD, cette commande concerne l'alimentation du moteur. 
Quatre signaux d'entrée informent le contrôleur: 
IPN Indique le passage du repère d'index (une impulsion négative par tour de disquette). Dans le QDD, ce bit indique la présence 
ou l'abscence de disquette (1 = disquette présente). 

Indique que la tête de lecture écriture est positionnée sur la piste 0. Avec le QDD, ce bit est envoyé constamment à l'état 0, ce qui permet au THMFC1 de "savoir" quel type de machine il doit contrôler. 
Indique que la disquette insérée dans la mécanique est protégée en écriture. 
Flot de données lues sur la disquette. 
Description et programmation des registres 
« Registre CMDO en écriture à E7DO 
commande de précompensation à 437,5 ns par pas de 62,5ns. 
inhibition du systième, lorsque le signal READY est inactif (bit à 1). 
128 mots/secteur 256 mots/secteur 512mots/secteur 
1024 mots/secteur 

« Registre CMD2 en écriture à E7D2 
Registre de commande, il a des fonctions différentes seion le drive utilisé: Floppy ou QDD. 

« Registre d'état STATO en lecture à E7DO, 
i m ade gI'heorloge caractère: demande d'opération 
par lecture ou écriture des registres RDATA ou WDATA. 
indication que l'opération se termine,
indication que l'opération est terminée. - erreur de CRC (check sum de la zone d'identification de données).
action identique au bit 7 pour les opérations dites intelligentes.
indique le bon résultat d'une détection synchro. 
» Registre d'état STAT1 en Jecture à E7D1
Ce registre contient des informations différentes selon le drive utilisé. 
bit 720 bit 631 
détection d'index pour lefloppy.
_ présence de disquette pour de QDD.
_ information de changement de disquette non utilisé pour 
1e QDD.
image inverse de la commande moteur MO, 
bit 5al 
bit 2àl 
bit 1atl bit 0 
—> 
—> 
bit 4 bit 3al 
—> àl —> 
—> détectiondelapisteOpourlefloppy. àl —> _ information de détection d'un QDD. 
—> information de protection en écriture sur le floppy et le QDD. - 
—> _ information "ready" en provenance du floppy ou QDD. —> non utilisé. 
oRegistres de données WDATA, RDATA en écriture ou lecture àE7D3. 
Ces registres 8 bits ont le rôle traditionnel de tampon. 
«Registre d'horloge type en écriture àE7D4, 
Ce registre 8 bits contient la configuration (FF) pour les données et (0A) pour les mots de synchro. 
«Registre secteur WSECT en écriture àE7D5, 
Comporte le numéro de secteur à chercher. Le contrôleur se charge de comparer les informations écrites dans ce registre avec celles présentes sur la disquette dans la zone d'identification. 
»Registre piste WTRCK en écriture àE7D6., Même gestion que pour le registre secteur. 
«Registre largeur de cellule WCELL en écriture àE7D7. 
bit 7 à O —> modification des caractéristiques du séparateur de données (pour pistes intérieures de la disquette. 
àl bits 6-0 
Précompensation).
—> _ fonctionnement normal du séparateur.
—> valeur permettant de charger le compteur du séparateur 
selon le mode de codage utilisé. 

Spécification d'un secteur 
Un secteur est composé d'un champ d'identification et d'un champ de données selon le modèle: 
Nombre d'octets 

Les fonctions “intelligentes” du contrôleur consistent à lire une adresse, un secieur ou écrire un secteur. Elles sont programmées par les bits 1 et 0 du registre CMDO. Chaque fonction doit permettre l'acquittement d'une série d'opérations répondant aux spécifications décrites ci-avant. 
